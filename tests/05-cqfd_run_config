#!/usr/bin/env bash
#
# validate the behavior of run command with alternative config file and build flavors

. "$(dirname "$0")/jtest.inc" "$1"

cd "$TDIR/" || exit 1

extdir="external/dir"
mkdir -p "$extdir"
mv .cqfdrc "$extdir/cqfdrc"

jtest_prepare "run cqfd run without argument and with option -f should pass"
if cqfd -f "$extdir/cqfdrc" run && [ -f a/cqfd_a.txt ]; then
	jtest_result pass
else
	jtest_result fail
fi
# cleanup
make clean

jtest_prepare "run cqfd run with argument and option -f should pass"
if cqfd -f "$extdir/cqfdrc" run "touch file" && [ -f file ]; then
	jtest_result pass
else
	jtest_result fail
fi
# cleanup
rm -f file

jtest_prepare "run cqfd run with argument and options -f and -b should pass"
if cqfd -f "$extdir/cqfdrc" -b foo run "touch foo" && [ -f foo ]; then
	jtest_result pass
else
	jtest_result fail
fi
# cleanup
rm -f foo

# restore initial .cqfdrc
mv -f "$extdir/cqfdrc" .cqfdrc

# cleanup
rmdir -p "$extdir"
