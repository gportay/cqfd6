#!/usr/bin/env bash
#
# validate the behavior of run command with alternative config file and build flavors

. "$(dirname "$0")/jtest.inc" "$1"

cd "$TDIR/" || exit 1

extdir="external/dir"
mkdir -p "$extdir"
mv .cqfdrc "$extdir/cqfdrc"

test_file="a/cqfd_a.txt"
jtest_prepare "run cqfd run without argument and with option -f should pass"
if cqfd -f "$extdir/cqfdrc" run && [ -f "$test_file" ]; then
	jtest_result pass
else
	jtest_result fail
fi
# cleanup
make clean

test_file="file.$RANDOM"
jtest_prepare "run cqfd run with argument and option -f should pass"
if cqfd -f "$extdir/cqfdrc" run "touch $test_file" && [ -f "$test_file" ]; then
	jtest_result pass
else
	jtest_result fail
fi
# cleanup
rm -f "$test_file"

test_file="foo.$RANDOM"
jtest_prepare "run cqfd run with argument and options -f and -b should pass"
if cqfd -f "$extdir/cqfdrc" -b foo run "touch $test_file" && [ -f "$test_file" ]; then
	jtest_result pass
else
	jtest_result fail
fi
# cleanup
rm -f "$test_file"

test_file="foo.$RANDOM"
jtest_prepare "run cqfd run with argument and options -b and -f should pass"
if cqfd -b foo -f "$extdir/cqfdrc" run "touch $test_file" && [ -f "$test_file" ]; then
	jtest_result pass
else
	jtest_result fail
fi
# cleanup
rm -f "$test_file"

# restore initial .cqfdrc
mv -f "$extdir/cqfdrc" .cqfdrc

# cleanup
rmdir -p "$extdir"
