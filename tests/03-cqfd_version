#!/usr/bin/env bash
#
# validate the behavior of --version option

. "$(dirname "$0")/jtest.inc" "$1"
cqfd="$TDIR/.cqfd/cqfd"

################################################################################
# 'cqfd --version' shall be an accepted command
################################################################################
jtest_prepare "cqfd --version shall exit normally"
if "$cqfd" --version >"$TDIR/version"; then
	jtest_result pass
	jtest_result fail
	rm -f "$TEST"
fi

################################################################################
# 'cqfd --version' shall produce a version message
################################################################################
jtest_prepare "cqfd --version shall produce a version string"
if grep -qE "^[0-9.]+(-[a-z]+)?\$" "$TDIR/version"; then
	jtest_result pass
else
	jtest_log error "not a version message"
	cat "$TEST" >&2
	jtest_result fail
fi

# cleanup
rm -f "$TDIR/version"
