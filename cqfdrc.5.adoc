= cqfdrc(5)
:doctype: manpage
:author: Gaël PORTAY
:email: gael.portay@gmail.com
:lang: en
:man manual: C.Q.F.D. Manual
:man source: C.Q.F.D. Project

== NAME

cqfdrc - project information config file

== DESCRIPTION

The _.cqfdrc_ file at the root of your project contains the information
required to support project tooling. It is written in an .ini-like format.

=== COMMENT

The _.cqfdrc_ file supports Unix shell comments; the words after the character
_#_ are ignored up to the end of line. A comment cannot be set in the first
line, and right after a section.

=== THE PROJECT SECTION

*org*::
	a short, lowercase name for the project’s parent organization.

*name*::
	a short, lowercase name for the project.

*build_context (optional)*::
	a directory to pass as the build context to Docker. This should be
	specified relatively to where _cqfd_ is invoked.  For example, it can
	be set to _._, to use the current working directory of the invoked
	_cqfd_ command as the Docker build context, which can be useful when
	files at the root of the project are required to build the image. When
	using this option, a _.dockerignore_ file can be useful to limit what
	gets sent to the Docker daemon.

*custom_img_name (optional)*::
	allows specifying a custom Docker image name instead of the one
	automatically generated by cqfd. You can also include a private
	repository URL in the image name. If you do, cqfd will try to pull the
	image from the provided repository, if not already available on your
	system.
	_custom_img_name_ is *deprecated*, use either _tag_ to name your image
	or _image_ to pull an image from a registry.

*tag (optional)*::
	allows specifying a Docker image name to use instead of the one
	automatically generated by cqfd. By default, cqfd uses
	__cqfd_%Un_%Po_%Pn_%Dh__ (__cqfd_%Un_%Po_%Pn_%Dh_%Bd__ if _distro_ is
	set). You can include environment variable names, as well as the
	following template marks:
	* *%Un* - user name
	* *%Po* - value of the `project.org` configuration key
	* *%Pn* - value of the `project.name` configuration key
	* *%Dh* - short hash of Dockerfile
	* *%DH* - long hash of Dockerfile
	* *%Bd* - value of the `build.distro` configuration key

*image (optional)*::
	allows specifying a Docker image to pull from a registry.

=== THE BUILD SECTION

==== CQFD RUN

*command*::
	The command string to be executed when cqfd is invoked. This string
	will be passed as an argument to a classical _sh -c "commands"_, within
	the build container, to generate the build artefacts.

*distro (optional)*::
	The name of the directory containing the Dockerfile. By default, cqfd
	uses _"docker"_, and _.cqfd/docker/Dockerfile_ is used.
	_distro_ is *deprecated*, use _dockerfile_ to set the path to the
	_Dockerfile_.

*user_extra_groups (optional)*::
	A space-separated list of groups the user should be a member of in the
	container. You can either use the _group:gid_ format, or simply specify
	the _group_ name if it exists either in the host or inside the docker
	image.

*flavors (optional)*::
	The list of build flavors (see below). Each flavor has its own command
	just like _build.command_. This property is now automatically deduced
	from the flavors sections of _.cqfdrc_.

*dockerfile (optional)*::
	The path to the _Dockerfile_. The path is relative to the project
	directory (i.e. the parent directory of _.cqfd_). By default, cqfd uses
	_.cqfd/$distro/Dockerfile_ with _distro=docker_ if _distro_ is unset.

*docker_build_args (optional)*::
	Arguments used to invoke _docker build_.

*docker_pull_args (optional)*::
	Arguments used to invoke _docker build_.

*docker_run_args (optional)*::
	Arguments used to invoke _docker run_.

==== CQFD RELEASE

*files*::
	The space-separated list of files generated by the build process that
	we want to include inside a standard release archive.

*archive (optional)*::
	The name of the release archive generated by cqfd. You can include
	environment variable names, as well as the following template marks:
	* *%Gh* - git short hash of last commit
	* *%GH* - git long hash of last commit
	* *%D3* - RFC3339 date (YYYY-MM-DD)
	* *%Du* - Unix timestamp
	* *%Cf* - current cqfd flavor name (if any)
	* *%Po* - value of the project.org configuration key
	* *%Pn* - value of the project.name configuration key
	* *%%* - a litteral '%' sign

By default, cqfd will generate a release archive named _org-name.tar.xz_, where
_org_ and _name_ come from the project's configuration keys. The .tar.xz,
.tar.gz and .zip archive formats are supported.

For tar archives:

* Setting _tar_transform=yes_ (optional) will cause all files specified for
  the archive to be stored at the root of the archive, which is desired in some
  scenarios.

* Setting _tar_options_ (optional) will pass extra options to the tar
  command. For example, setting _tar_options=-h_ will copy all symlink files as
  hardlinks, which is desired in some scenarios.

== EXAMPLES

=== BASIC

Here is a sample _.cqfdrc_ file

	[project]
	org='fooinc'
	name='buildroot'

	[build]
	command='make foobar_defconfig && make && asciidoc README.FOOINC'
	files='README.FOOINC output/images/sdcard.img'
	archive='cqfd-%Gh.tar.xz'

=== USING FLAVORS

In some cases, it may be desirable to build the project using variations of the
build and release methods (for example a debug build). This is made possible in
*cqfd(1)* with the build _flavors_ feature.

In the _.cqfdrc_ file, one or more flavors may be listed in the _[build]_
section, referencing other sections named following flavor's name.

	[centos7]
	command='make CENTOS=1'
	distro='centos7'

	[debug]
	command='make DEBUG=1'
	files='myprogram Symbols.map'

	[build]
	command='make'
	files='myprogram'

A _flavor_ will typically redefine some keys of the build section: _command_,
_files_, _archive_, _distro_.

== PATCHES

Submit patches at *https://github.com/gportay/cqfd6/issues*

== BUGS

Report bugs at *https://github.com/gportay/cqfd6/issues*

== COPYRIGHT

Copyright (C) 2017,2025 Gaël PORTAY

Copyright (C) 2015-2025 Savoir-faire Linux, Inc.

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, version 3.

== TRIVIA

CQFD stands for "ce qu'il fallait Dockeriser", French for "what needed to be
Dockerized".

== SEE ALSO

*docker-build(1)*, *docker-run(1)*, *cqfd(1)*
